name: object_fields
icon: textbox
enable_api: true
enable_inline_edit: false
enable_enhanced_lookup: true
enable_dataloader: false
hidden: true
label: Object Fields
version: 2
paging:
  enabled: false
relatedList:
  - permission_fields
form:
  initialValues: !<tag:yaml.org,2002:js/function> |-
    function anonymous(
    ) {

      //应用程序微页面内Session.get("record_id")获取不到值（比如设计字段布局微页面）
      var object = Creator.odata.get('objects', Session.get("record_id") || (this.master && this.master.recordId), "fields_serial_number");
      if(object){
        let fields_serial_number = object.fields_serial_number
        if(!fields_serial_number || fields_serial_number < 100){
          fields_serial_number = 100 + 10
        }
        return {sort_no: fields_serial_number}
      }
      return {}

    }
  afterInsert: !<tag:yaml.org,2002:js/function> |-
    function anonymous(
    ) {

      Creator.objectLayoutMananger.appendField(this.doc);

    }
  onValuesChange: !<tag:yaml.org,2002:js/function> |-
    function anonymous(args
    ) {

      /*以下代码是为解决issue:优化：使用新版form新建字段后，每种字段类型都多了3个属性formula_blank_value、precision、scale #1920*/
      const fieldType = args.values.type, 
        changedFieldType = args.changedValues.type,
        numberTypes = ['number', 'currency', 'percent'];

      if(changedFieldType === 'textarea'){
        args.form.setFieldsValue({rows: 3});
      }
      else if(fieldType !== 'textarea' && args.values.rows !== undefined){
        args.form.setFieldsValue({rows: undefined});
      }  

      if(changedFieldType === 'formula'){
        args.form.setFieldsValue({formula_blank_value: 'zeroes'});
      }
      else if(fieldType !== 'formula' && args.values.formula_blank_value !== undefined){
        args.form.setFieldsValue({formula_blank_value: undefined});
      }

      if(numberTypes.indexOf(changedFieldType) > -1 || 'summary' === changedFieldType){
         args.form.setFieldsValue({precision: 18, scale: 2});
      }
      if(['formula'].indexOf(fieldType) > -1 && numberTypes.indexOf(args.changedValues.data_type) > -1){
        args.form.setFieldsValue({precision: 18, scale: 2});
      }
      if(numberTypes.indexOf(fieldType) < 0 && 'summary' !== fieldType && numberTypes.indexOf(args.values.data_type) < 0 ){
        if(args.values.precision !== undefined){
            args.form.setFieldsValue({precision: undefined});
        }
        if(args.values.scale !== undefined){
            args.form.setFieldsValue({scale: undefined});
        }
      }

    }
